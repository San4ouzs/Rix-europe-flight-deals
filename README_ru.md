# Поиск дешёвых авиабилетов из RIX по Европе (ниже среднегодовой цены)

Этот инструмент опрашивает несколько источников (начиная с Kiwi Tequila API) и находит направления из **Рижского аэропорта (RIX)** по Европе, где текущая цена **ниже средней за год** по данному направлению. Результат — таблица в консоли и файл `deals.csv`.

> ⚠️ Требуются API‑ключи. Стартовая реализация использует [Kiwi (Tequila) API](https://tequila.kiwi.com/). Вы можете бесплатно получить ключ после регистрации. Также заложена архитектура для подключения Ryanair/Wizz Air/Amadeus/Skyscanner и т.д.

## Быстрый старт

1) Установите зависимости:
```bash
python -m venv .venv && . .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

2) Создайте файл `.env` на основе `.env.example` и заполните:
```
TEQUILA_API_KEY=ваш_ключ
```

3) Запустите поиск:
```bash
python main.py --days 180 --threshold 1.0 --nonstop --max-price 200
```
- `--days 180` — смотреть вылеты в ближайшие 180 дней
- `--threshold 1.0` — показывать предложения ниже 100% среднегодовой цены (можно, например, 0.85 для «ниже на 15%»)
- `--nonstop` — только прямые рейсы (уберите флаг, если нужны и с пересадками)
- `--max-price 200` — необязательный фильтр по абсолютной цене (€)

Результаты появятся в консоли и сохранятся в `deals.csv`.

## Как считается «средняя за год»

- Основной путь: календарь/граф цен от Tequila (в пределах следующих 365 дней).
- Если календарь недоступен, берём усреднение по широкому диапазону поиска (например, 180 дней) как приближение.
- Вы можете накапливать локальную историю цен (в `deals.sqlite`) — включите флаг `--persist` и скрипт будет записывать наблюдения, а затем усреднять по накопленным данным.

## Подключение других источников

Архитектура адаптеров позволяет добавить провайдеры в `adapters/`. Пример заглушки для Ryanair включён. Добавьте ключи/эндпоинты — и подключите адаптер во `main.py`.

## Примеры

- Все выдающиеся сделки (ниже среднего) из RIX по Европе за 120 дней, без ограничений по пересадкам:
```bash
python main.py --days 120
```
- Только сделки ниже среднего хотя бы на 20% и не дороже €120:
```bash
python main.py --threshold 0.8 --max-price 120
```

## Замечания
- Некоторые сайты блокируют «скрейпинг». Используйте официальные API.
- Курсы в евро. При необходимости измените валюту флагом `--currency`.
- Время в UTC; для локального форматирования можно добавить параметр `--tz Europe/Riga` (пока не влияет на логику).